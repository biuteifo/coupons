apply plugin: 'org.springframework.boot'
apply plugin: 'com.palantir.docker'

bootJar {
    launchScript()
    exclude("bootstrap.yml")
}

docker {
    name "alexbob/${project.name}"
    tag "latest", "registry.cn-zhangjiakou.aliyuncs.com/alexbob/${project.name}:latest"
    dockerfile file('docker/Dockerfile')
    files(bootJar.archiveFile.get(),file('docker/bootstrap.properties'))
    buildArgs(['JAR_FILE': "${bootJar.archiveFileName.get()}"])
    pull true
    noCache true
}


dependencies {

    implementation 'org.springframework.boot:spring-boot-starter-webflux'
    implementation 'org.springframework.cloud:spring-cloud-starter-gateway'

    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.session:spring-session-data-redis'
    implementation 'org.springframework.boot:spring-boot-starter-data-redis-reactive'


    implementation 'org.springframework.boot:spring-boot-starter-amqp'

    implementation 'org.springframework.boot.experimental:spring-boot-starter-data-r2dbc'
    implementation 'io.r2dbc:r2dbc-postgresql'

    testImplementation 'org.springframework.boot.experimental:spring-boot-test-autoconfigure-r2dbc'
    testImplementation 'io.projectreactor:reactor-test'
    testImplementation 'org.springframework.amqp:spring-rabbit-test'

}
